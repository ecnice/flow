var Q=Object.defineProperty;var U=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var z=(n,s,o)=>s in n?Q(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o,k=(n,s)=>{for(var o in s||(s={}))X.call(s,o)&&z(n,o,s[o]);if(U)for(var o of U(s))Y.call(s,o)&&z(n,o,s[o]);return n};var L=(n,s,o)=>new Promise((C,h)=>{var w=c=>{try{m(o.next(c))}catch(p){h(p)}},b=c=>{try{m(o.throw(c))}catch(p){h(p)}},m=c=>c.done?C(c.value):Promise.resolve(c.value).then(w,b);m((o=o.apply(n,s)).next())});import{B as Z}from"./TableImg.513742d5.js";import{T as ee}from"./BasicForm.0ba2e15f.js";import{u as ne}from"./useTable.6e5baa13.js";import{g as oe,a as te,s as ae,d as se,b as ie}from"./personal.2ea6ac2c.js";import{P as le}from"./index.ea14bdae.js";import re from"./OrgTree.e1eb4fc9.js";import{b as V}from"./index.c505e96f.js";import{P as de,c as ue,s as ce}from"./PersonalModal.4d054996.js";import pe from"./index.a5caea48.js";import me from"./index.b01bb303.js";import{A as fe,aP as ge,c3 as he,bA as be,c2 as _e,aE as Se,ba as je,bJ as ve,c8 as ye,cv as Ce,cw as we,cx as Be,r as v,u,a0 as t,B as y,a1 as x,a6 as d,w as r,ae as $,J,H as Re,D as xe,ap as Pe,ab as Te}from"./vendor.5879c5ca.js";/* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css                */import{_ as Ie}from"./index.e84e956c.js";/* empty css                *//* empty css              */import"./useForm.696aa965.js";/* empty css                *//* empty css                */import"./uuid.2b29000c.js";import"./useWindowSizeFn.6a6adedd.js";/* empty css               */import"./useSortable.a10c06e7.js";/* empty css               *//* empty css               */import"./index.8b70aabd.js";/* empty css                *//* empty css                *//* empty css                */import"./download.e6dbd100.js";import"./base64Conver.bb012c73.js";import"./index.e83a4b09.js";/* empty css                */import"./useContentViewHeight.ccc8749b.js";import"./Tree.vue_vue_type_style_index_0_lang.128b82eb.js";import"./useContextMenu.44cd9a61.js";import"./dept.2ea41d4f.js";import"./company.54be1035.js";import"./jobGrade.2483baa0.js";import"./positionInfo.fb28731c.js";import"./role.50d962e5.js";import"./CompanyTree.1a3efee0.js";const De=fe({name:"PersonalManagement",components:{BasicTable:Z,Spin:ge,Space:he,PageWrapper:le,OrgTree:re,PersonalModal:de,RoleSelector:pe,PersonalSelector:me,TableAction:ee,Avatar:be,Badge:_e,Popconfirm:Se,Tag:je,Image:ve,DeleteOutlined:ye,ManOutlined:Ce,WomanOutlined:we,UserOutlined:Be},setup(){const[n,{openModal:s,setModalProps:o}]=V(),[C,{openModal:h,setModalProps:w}]=V(),[b,{openModal:m,setModalProps:c}]=V(),p=v({}),_=v({}),B=v(""),S=v(!1),a=v({}),[P,{reload:g,setLoading:W}]=ne({title:"\u5217\u8868",api:oe,columns:ue,formConfig:{labelWidth:120,schemas:ce,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},searchInfo:{showRoles:!0},size:"small",useSearchForm:!0,showIndexColumn:!1,bordered:!0,actionColumn:{width:120,title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"}},beforeFetch:e=>{var f,N;let l={};return((f=a.value)==null?void 0:f.sourceType)==="1"?l={companyId:u(a).id}:((N=a.value)==null?void 0:N.sourceType)==="2"&&(l={deptId:u(a).id}),k(k({},e),l)}});function T(){let e={};u(a)&&(u(a).sourceType==="1"?e={companyId:u(a).id}:u(a).sourceType==="2"&&(e={companyId:u(a).companyId,deptId:u(a).id})),s(!0,{isUpdate:!1,record:e}),o({title:"\u65B0\u589E\u4EBA\u5458",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:400})}function I(e){s(!0,{record:e,isUpdate:!0}),o({title:"\u4FEE\u6539\u4EBA\u5458",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:420})}function D(e){p.value=e,h(!0,{personalId:p.value.id}),w({title:`\u7ED9\u3010${e.name}(${e.code})\u3011\u6DFB\u52A0\u89D2\u8272`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function E(e){p.value=e;let l=[];e.leaderCode&&e.leaderName&&l.push({id:e.id,code:e.leaderCode,name:e.leaderName}),m(!0,{selectorProps:{multiSelect:!1,selectedList:l}}),c({title:`\u7ED9\u3010${e.name}(${e.code})\u3011\u8BBE\u7F6E\u9886\u5BFC`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function M(e){return L(this,null,function*(){const l=e.map(f=>({id:f.id}));yield te({personalId:u(p).id,roles:l}),R()})}function F(e){return L(this,null,function*(){e&&e.length>0&&ae({leaderCode:e[0].code,id:u(p).id}).then(()=>{R()}).finally(()=>{})})}function O(e){se([e.id]).then(l=>{console.log(l),g()})}function A(){g()}function i(){g()}function j(){}function H(e){e&&(B.value=e,S.value=!0)}function G(e,l){S.value=e}function q(e,l){_.value[e]=!0,ie({personalId:e,roleId:l}).then(()=>{R()}).finally(()=>{_.value[e]=!1})}function R(){var l,f;let e={};((l=a.value)==null?void 0:l.sourceType)==="1"?e={companyId:u(a).id}:((f=a.value)==null?void 0:f.sourceType)==="2"&&(e={deptId:u(a).id}),g({searchInfo:e})}function K(e){a.value=e,R()}return{registerTable:P,registerRoleModal:C,registerPersonalModal:b,registerModal:n,deleteRoleLoading:_,previewImage:B,previewImageVisible:S,previewImageHandle:H,previewImageVisibleChange:G,handleCreate:T,handleEdit:I,confirmDeleteRole:q,cancelDeleteRole:j,handleSettingRoles:D,handleSettingLeader:E,handleDelete:O,handleSuccess:i,handleSettingRoleSuccess:M,handleSettingLeaderSuccess:F,handleSelect:K,doSearch:A}}}),Ee=$("\u65B0\u589E"),Me={class:"personal-roles"};function Fe(n,s,o,C,h,w){const b=t("OrgTree"),m=t("a-button"),c=t("TableAction"),p=t("WomanOutlined"),_=t("ManOutlined"),B=t("UserOutlined"),S=t("Avatar"),a=t("Badge"),P=t("DeleteOutlined"),g=t("Popconfirm"),W=t("Tag"),T=t("Space"),I=t("Spin"),D=t("BasicTable"),E=t("Image"),M=t("PersonalModal"),F=t("RoleSelector"),O=t("PersonalSelector"),A=t("PageWrapper");return y(),x(A,{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:d(()=>[r(b,{class:"w-1/4 xl:w-1/5",onSelect:n.handleSelect},null,8,["onSelect"]),r(D,{onRegister:n.registerTable,class:"w-3/4 xl:w-4/5"},{toolbar:d(()=>[r(m,{type:"primary",onClick:n.handleCreate},{default:d(()=>[Ee]),_:1},8,["onClick"])]),action:d(({record:i})=>[r(c,{actions:[{tooltip:"\u4FEE\u6539",icon:"clarity:note-edit-line",onClick:n.handleEdit.bind(null,i)},{tooltip:"\u5220\u9664",icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDelete.bind(null,i)}}],dropDownActions:[{label:"\u5206\u914D\u89D2\u8272",title:"\u5206\u914D\u89D2\u8272",icon:"ant-design:usergroup-add",onClick:n.handleSettingRoles.bind(null,i)},{title:"\u8BBE\u7F6E\u9886\u5BFC",label:"\u8BBE\u7F6E\u9886\u5BFC",icon:"ant-design:setting-outlined",onClick:n.handleSettingLeader.bind(null,i)}]},null,8,["actions","dropDownActions"])]),nameRender:d(({record:i})=>[r(a,null,{count:d(()=>[i.sex===2?(y(),x(p,{key:0,style:{color:"#f5222d","font-size":"12px"}})):(y(),x(_,{key:1,style:{color:"#1890ff","font-size":"12px"}}))]),default:d(()=>[r(S,{src:i.headImg,onClick:j=>n.previewImageHandle(i.headImg)},{icon:d(()=>[r(B)]),_:2},1032,["src","onClick"])]),_:2},1024),$(" "+J(i.name),1)]),rolesRender:d(({record:i})=>[Re("div",Me,[r(I,{spinning:n.deleteRoleLoading&&n.deleteRoleLoading[i.id]?n.deleteRoleLoading[i.id]:!1},{default:d(()=>[r(T,null,{default:d(()=>[(y(!0),xe(Te,null,Pe(i.roles,j=>(y(),x(W,{class:"role-item"},{default:d(()=>[$(J(j.name)+" ",1),r(g,{title:"\u786E\u5B9A\u8981\u5220\u9664\u5417?","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",onConfirm:H=>n.confirmDeleteRole(i.id,j.id),onCancel:n.cancelDeleteRole},{default:d(()=>[r(P,{color:"error",style:{color:"#d9595b"}})]),_:2},1032,["onConfirm","onCancel"])]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["spinning"])])]),_:1},8,["onRegister"]),r(E,{width:0,height:0,src:n.previewImage,preview:{visible:n.previewImageVisible,onVisibleChange:n.previewImageVisibleChange}},null,8,["src","preview"]),r(M,{onRegister:n.registerModal,onSuccess:n.handleSuccess},null,8,["onRegister","onSuccess"]),r(F,{onRegister:n.registerRoleModal,onSuccess:n.handleSettingRoleSuccess},null,8,["onRegister","onSuccess"]),r(O,{onRegister:n.registerPersonalModal,onSuccess:n.handleSettingLeaderSuccess},null,8,["onRegister","onSuccess"])]),_:1})}var Pn=Ie(De,[["render",Fe]]);export{Pn as default};
