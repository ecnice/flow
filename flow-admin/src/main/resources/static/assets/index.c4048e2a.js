var A=Object.defineProperty;var B=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var E=(e,a,t)=>a in e?A(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,C=(e,a)=>{for(var t in a||(a={}))$.call(a,t)&&E(e,t,a[t]);if(B)for(var t of B(a))I.call(a,t)&&E(e,t,a[t]);return e};var w=(e,a,t)=>new Promise((o,d)=>{var v=c=>{try{n(t.next(c))}catch(r){d(r)}},i=c=>{try{n(t.throw(c))}catch(r){d(r)}},n=c=>c.done?o(c.value):Promise.resolve(c.value).then(v,i);n((t=t.apply(e,a)).next())});import{B as R,a as V}from"./index.30115123.js";import{P as F}from"./index.77f474a0.js";import{A as W,ba as H,aP as z,ct as q,r as f,S as x,$ as b,j as G,a0 as g,bo as Q,B as y,a1 as O,a6 as T,H as U,D as X,ap as Y,ae as Z,J as ee,ab as te,ad as se,w as J,F as le,a4 as ae,u as ne}from"./vendor.7bee64cc.js";/* empty css               */import{a as re}from"./dept.5a8fb534.js";import{_ as oe,bd as j}from"./index.9eb02b52.js";import{_ as ie}from"./Tree.vue_vue&type=style&index=0&lang.43e63f89.js";import"./useWindowSizeFn.30e15ddc.js";/* empty css                *//* empty css                */import"./useContentViewHeight.52836077.js";import"./useContextMenu.e899090d.js";/* empty css               */const ce=W({props:{title:{type:String,default:"\u4EBA\u5458\u9009\u62E9"}},name:"OrgSelector",components:{BasicModal:R,PageWrapper:F,Tag:H,BasicTree:ie,Spin:z,CloseCircleOutlined:q},setup(e,{emit:a}){const t=f([]),o=f(!1),d=f([]),v=f(!1),i=f([]),n=f([]),c=f(null);function r(){const s=ne(c);if(!s)throw new Error("tree is null!");return s}x(n,(s,u)=>{if(o.value){const m=s.map(p=>{let l=j(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return l=C({},l),delete l.children,l});b(()=>{t.value=JSON.parse(JSON.stringify(m)),r().setCheckedKeys(s)})}else{const m=s.map(p=>{let l=j(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return l=C({},l),delete l.children,l});b(()=>{t.value=JSON.parse(JSON.stringify(m)),r().setSelectedKeys(s)})}},{immediate:!0,deep:!0}),x(i,(s,u)=>{if(!o.value){const m=s.map(p=>{let l=j(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return l=C({},l),delete l.children,l});b(()=>{t.value=JSON.parse(JSON.stringify(m)),r().setSelectedKeys(s)})}},{immediate:!0,deep:!0});const[k,{setModalProps:_,closeModal:S}]=V(s=>w(this,null,function*(){const{selectorProps:u}=s;v.value=!0,o.value=u.multiSelect,re().then(m=>{d.value=m,console.log(u.selectedList);let p=u.selectedList.map(l=>l.id);o.value?(n.value=p,setTimeout(()=>{r().setCheckedKeys(n.value),r().setExpandedKeys(n.value)},200)):(i.value=p,setTimeout(()=>{r().setSelectedKeys(i.value),r().setExpandedKeys(i.value)},200))}).finally(()=>{v.value=!1}),_({wrapClassName:"selector-content"})}));function N(s){o.value?n.value=JSON.parse(JSON.stringify(s.checked)):n.value=JSON.parse(JSON.stringify(s.checked.length>0?[s.checked[0]]:[]))}function D(s){if(!o.value)i.value=s;else debugger}const K=G(()=>"\u9009\u62E9\u4EBA\u5458");function M(){o.value?n.value=[]:i.value=[]}function P(s){o.value?n.value.splice(n.value.findIndex(u=>u===s),1):i.value.splice(i.value.findIndex(u=>u===s),1)}function L(){a("success",t),S()}return{treeRef:c,multiSelect:o,treeData:d,treeLoading:v,registerModal:k,getTitle:K,selectedList:t,removeAllSelected:M,removeSelectedItem:P,handleSubmit:L,handleCheck:N,handleSelect:D}}}),de={class:"selected-items"};function ue(e,a,t,o,d,v){const i=g("Tag"),n=g("CloseCircleOutlined"),c=g("BasicTree"),r=g("PageWrapper"),k=g("BasicModal"),_=Q("loading");return y(),O(k,ae({wrapClassName:"selector-body org"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:T(()=>[U("div",de,[(y(!0),X(te,null,Y(e.selectedList,S=>(y(),O(i,{color:"processing",closable:"",onClose:N=>{N.preventDefault(),e.removeSelectedItem(S.id)}},{default:T(()=>[Z(ee(S.shortName),1)]),_:2},1032,["onClose"]))),256)),e.selectedList.length>0?(y(),O(n,{key:0,class:"close-all",title:"\u6E05\u7A7A",onClick:e.removeAllSelected},null,8,["onClick"])):se("",!0)]),J(r,{dense:"",contentClass:"flex"},{default:T(()=>[le(J(c,{ref:"treeRef",class:"w-4/4 org-tree",title:"\u7EC4\u7EC7",search:"",clickRowToExpand:!1,treeData:e.treeData,replaceFields:{key:"id",title:"shortName"},onCheck:e.handleCheck,onSelect:e.handleSelect,checkable:!!e.multiSelect,selectable:!e.multiSelect,checkStrictly:!0,autoExpandParent:""},null,8,["treeData","onCheck","onSelect","checkable","selectable"]),[[_,e.treeLoading]])]),_:1})]),_:1},16,["onRegister","title","onOk"])}var Te=oe(ce,[["render",ue]]);export{Te as default};
